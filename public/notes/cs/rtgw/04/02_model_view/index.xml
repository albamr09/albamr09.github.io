<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Alba&#39;s Notes â€“ Model, View and Projection Transform</title>
    <link>//localhost:1313/notes/cs/rtgw/04/02_model_view/</link>
    <description>Recent content in Model, View and Projection Transform on Alba&#39;s Notes</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    
	  <atom:link href="//localhost:1313/notes/cs/rtgw/04/02_model_view/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Perspective Matrix</title>
      <link>//localhost:1313/notes/cs/rtgw/04/02_model_view/02_01_perspective/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>//localhost:1313/notes/cs/rtgw/04/02_model_view/02_01_perspective/</guid>
      <description>
        
        
        &lt;h2&gt;Fundamentals&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;fundamentals&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#fundamentals&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Let&amp;rsquo;s now examine how points are projected in OpenGL (or WebGL). A line is drawn from the camera&amp;rsquo;s origin to the point $P$ that we want to project, and the intersection of this line with the image plane determines the position of the projected point $P_s$. It&amp;rsquo;s important to note that in OpenGL, the image plane is situated on the near clipping plane.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;../../../assets/perspective_projection.png&#34; alt=&#34;Perspective Projection&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The triangles $\Delta ABC$ and $\Delta DEF$ are similar. Thus, we can express:&lt;/p&gt;
$$
\begin{aligned}
\frac{AB}{DE} = \frac{BC}{EF}
\end{aligned}
$$&lt;p&gt;By substituting $AB$ with $n$ (the near clipping plane), $DE$ with $P_z$ (the z-coordinate of $P$), and $EF$ with $P_y$ (the y-coordinate of $P$), we can rewrite this equation as:&lt;/p&gt;
$$
\begin{aligned}
\frac{n}{-P_z} = \frac{BC}{P_y}
\end{aligned}
$$&lt;p&gt;And solving for $BC$ we obtain:&lt;/p&gt;
$$
\begin{aligned}
BC = P_{sy} \frac{n \cdot P_y}{-P_z}
\end{aligned}
$$&lt;p&gt;Note that since the camera is oriented along the negative z-axis, $P_z$ is negative, so, to maintain the sign of the y-coordinate, we negate $P_z$. Following the same logic, we derive the x-coordinate of the projected point with the following equation:&lt;/p&gt;
$$
\begin{aligned}
P_{s_x} = \frac{n \cdot P_x}{-P_z}
\end{aligned}
$$&lt;p&gt;Following the same reasoning for $P_y$, we obtain:&lt;/p&gt;
$$
\begin{aligned}
P_{s_y} = \frac{n \cdot P_y}{-P_z}
\end{aligned}
$$&lt;h2&gt;Derivation&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;derivation&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#derivation&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;We need to figure out how $P_{sx}$ and $P_{sy}$ correlate with the WebGL perspective matrix. The purpose of a projection matrix is to remap the values projected onto the image plane to a unit cube (defined by minimum $(-1, -1, -1)$ and maximum $(1, 1, 1)$).&lt;/p&gt;
&lt;h3&gt;Projected X&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;projected-x&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#projected-x&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Once the point $P$ is projected onto the image plane (near clipping plane), is considered visible if its and coordinates fall within the range $[left, right]$ for $x$ and $[bottom, top]$ for $y$, as depicted in Figure 2.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;../../../assets/frustrum.png&#34; alt=&#34;Frustrum&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Such that:&lt;/p&gt;
$$
\begin{aligned}
l \leq P_{sx} \leq r
\end{aligned}
$$&lt;p&gt;where $l$ and $r$ are the left and right coordinates respectively. Our objective is to remap so that its final value resides within the range $[-1, 1]$:&lt;/p&gt;
$$
\begin{aligned}
0 \leq P_{sx} - l \leq r - l
\end{aligned}
$$&lt;p&gt;normalizing by dividing by $r - l$ gives:&lt;/p&gt;
$$
\begin{aligned}
0 \leq \frac{P_{sx} - l}{r - l} \leq 1
\end{aligned}
$$&lt;p&gt;multiplying all terms by $2$:&lt;/p&gt;
$$
\begin{aligned}
0 \leq 2 \frac{P_{sx} - l}{r - l} \leq 2
\end{aligned}
$$&lt;p&gt;substracting $1$ from all terms results in:&lt;/p&gt;
$$
\begin{aligned}
-1 \leq 2 \frac{P_{sx} - l}{r - l} - 1 \leq 1
\end{aligned}
$$&lt;p&gt;Now the central term on the inequality is defined to exist on the range $[-1, 1]$, which is what we wanted. With some further rearrangement:&lt;/p&gt;
$$
\begin{aligned}
-1 \leq 2 \frac{P_{sx} - l}{r - l} - \frac{r - l}{r - l} \leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{2P_{sx} - 2l - r + l}{r - l}\leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{2P_{sx} - r - l}{r - l}\leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{2P_{sx}}{r - l} - \frac{r + l}{r - l}\leq 1
\end{aligned}
$$&lt;p&gt;The two central terms are quite similar to the first two terms of the first row in the WebGL perspective projection matrix. If we replace $P_{sx}$ from the previous equation with&lt;/p&gt;
$$
\begin{aligned}
P_{sx} = \frac{n P_x}{-P_z}
\end{aligned}
$$&lt;p&gt;we get:&lt;/p&gt;
$$
\begin{aligned}
-1 \leq \frac{2nP_x}{-P_z(r - l)} - \frac{r + l}{r - l}\leq 1
\end{aligned}
$$&lt;p&gt;We can encode this equation in matrix form if we replace the first and third coefficients of the matrix&amp;rsquo;s first row with the first and second term of this formula:&lt;/p&gt;
$$
\begin{aligned}
\begin{bmatrix}
\frac{2n}{r - l} &amp; 0 &amp; \frac{r + l}{r - l} &amp; 0 \\
\cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
\cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
0 &amp; 0 &amp; -1 &amp; 0
\end{bmatrix}
\end{aligned}
$$&lt;p&gt;So computing $P_{sx}$ yields:&lt;/p&gt;
$$
\begin{aligned}
\begin{bmatrix}
\frac{2n}{r - l} &amp; 0 &amp; \frac{r + l}{r - l} &amp; 0 \\
\cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
\cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
0 &amp; 0 &amp; -1 &amp; 0
\end{bmatrix} \cdot
\begin{bmatrix}
P_x \\
P_y \\
P_z \\
P_w \\
\end{bmatrix}
\end{aligned}
$$&lt;p&gt;such that:&lt;/p&gt;
$$
\begin{aligned}
P_{sx} = \frac{2n}{r - l} P_x + \frac{r + l}{r - l} P_z
\end{aligned}
$$&lt;p&gt;And since $P_{sx}$ will be divided at the end of the process by $-P_z$ when we convert from homogeneous to Cartesian coordinates, we get:&lt;/p&gt;
$$
\begin{aligned}
P_{sx} = \frac{\frac{2n}{r - l} P_x}{-P_z} + \frac{\frac{r + l}{r - l} P_z}{-P_z} = \frac{2nP_x}{-P_z(r - l)} - \frac{r + l}{r - l}
\end{aligned}
$$&lt;p&gt;This is the first coordinate of the projected point $P_{s}$ computed using the WebGL perspective matrix.&lt;/p&gt;
&lt;h3&gt;Projected Y&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;projected-y&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#projected-y&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The derivation for $P_{sy}$ is analogous, replacing $l$ and $r$ with and $b$ and $t$, such that:&lt;/p&gt;
$$
\begin{aligned}
b \leq P_{s_y} \leq t
\end{aligned}
$$$$
\begin{aligned}
0 \leq P_{s_y} - b \leq t - b
\end{aligned}
$$$$
\begin{aligned}
0 \leq \frac{P_{s_y} - b}{t - b} \leq 1
\end{aligned}
$$&lt;p&gt;We multiply by $2$:&lt;/p&gt;
$$
\begin{aligned}
0 \leq 2\frac{P_{s_y} - b}{t - b} \leq 2
\end{aligned}
$$&lt;p&gt;And we substract $1$:&lt;/p&gt;
$$
\begin{aligned}
-1 \leq 2\frac{P_{s_y} - b}{t - b} - 1 \leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq 2\frac{P_{s_y} - b}{t - b} - \frac{t - b}{t - b} \leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{2P_{s_y} - 2b - t + b}{t - b} \leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{2P_{s_y} - b - t}{t - b} \leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{2P_{s_y}}{t - b} - \frac{t + b}{t - b} \leq 1
\end{aligned}
$$&lt;p&gt;Given we know that:&lt;/p&gt;
$$
\begin{aligned}
P_{s_y} = \frac{n P_y}{-P_z}
\end{aligned}
$$&lt;p&gt;then:&lt;/p&gt;
$$
\begin{aligned}
-1 \leq \frac{2n P_y}{-P_z(t - b)} - \frac{t + b}{t - b} \leq 1
\end{aligned}
$$&lt;p&gt;Therefore, now our projection matrix has the following shape:&lt;/p&gt;
$$
\begin{aligned}
\begin{bmatrix}
\frac{2n}{r - l} &amp; 0 &amp; \frac{r + l}{r - l} &amp; 0 \\
0 &amp; \frac{2n}{t - b} &amp; \frac{t + b}{t - b} &amp; 0 \\
\cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
0 &amp; 0 &amp; -1 &amp; 0
\end{bmatrix}
\end{aligned}
$$&lt;p&gt;Computing $P_{s_y}$ using this matrix gives:&lt;/p&gt;
$$
\begin{aligned}
\begin{bmatrix}
\frac{2n}{r - l} &amp; 0 &amp; \frac{r + l}{r - l} &amp; 0 \\
0 &amp; \frac{2n}{t - b} &amp; \frac{t + b}{t - b} &amp; 0 \\
\cdots &amp; \cdots &amp; \cdots &amp; \cdots \\
0 &amp; 0 &amp; -1 &amp; 0
\end{bmatrix} \cdot
\begin{bmatrix}
x \\
y \\
w \\
z \\
\end{bmatrix}
\end{aligned}
$$$$
\begin{aligned}
P_{s_y} = 0 \cdot x + \frac{2n}{t - b} P_y + \frac{t + b}{t - b}P_z + 0
\end{aligned}
$$&lt;p&gt;and after the divsion by $-P_z$:&lt;/p&gt;
$$
\begin{aligned}
P_{s_y} = \frac{\frac{2n}{t - b}P_y}{-P_z}  + \frac{\frac{t + b}{t - b}P_z}{-P_z}
\end{aligned}
$$$$
\begin{aligned}
= \frac{2n P_y}{-P_z(t - b)}  - \frac{t + b}{t - b}
\end{aligned}
$$&lt;h3&gt;Projected Z&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;projected-z&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#projected-z&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;All that&amp;rsquo;s left to do to complete it is find a way to remap the z-coordinate of the projected points to the range $[-1,1]$&lt;/p&gt;
&lt;p&gt;We know that the $x$ and $y$ coordinates of $P$ don&amp;rsquo;t contribute to the calculation of the projected point&amp;rsquo;s z-coordinate. Thus, the first and second coefficients of the matrix&amp;rsquo;s third row are necessarily zero. We are left with the following matrix:&lt;/p&gt;
$$
\begin{aligned}
\begin{bmatrix}
\frac{2n}{r - l} &amp; 0 &amp; \frac{r + l}{r - l} &amp; 0 \\
0 &amp; \frac{2n}{t - b} &amp; \frac{t + b}{t - b} &amp; 0 \\
0 &amp; 0 &amp; A &amp; B \\
0 &amp; 0 &amp; -1 &amp; 0
\end{bmatrix}
\end{aligned}
$$&lt;p&gt;If we write the equation to compute $P_{s_z}$ using this matrix, we get:&lt;/p&gt;
$$
\begin{aligned}
P_{s_z} = \frac{0 \cdot P_x + 0 \cdot P_y + A \cdot P_z + B \cdot P_w}{P_{s_w} = - P_z}
\end{aligned}
$$$$
\begin{aligned}
\frac{A \cdot P_z + B}{P_{s_w} = -P_z}
\end{aligned}
$$&lt;p&gt;Note that we are dividing $P_{s_z}$ by $P_{s_w}$ when the point is converted from homogeneous to Cartesian coordinates, and that $P_w = 1$.&lt;/p&gt;
&lt;p&gt;We need to find the values of $A$ and $B$. We know that when $P_z$ is on the near clipping plane, $P_{s_z}$ needs to be remapped to $-1$, and when $P_z$ is on the far clipping plane, $P_{s_z}$needs to be remapped to $1$.&lt;/p&gt;
&lt;p&gt;So, when $P_z$ is on the near plane, the previous equation is as follows:&lt;/p&gt;
$$
\begin{aligned}
\frac{A \cdot (P_z = -n) + B}{(-P_z = -(-n) = n)} = -1
\end{aligned}
$$$$
\begin{aligned}
\frac{A \cdot -n + B}{n} = -1
\end{aligned}
$$$$
\begin{aligned}
-nA + B = -n
\end{aligned}
$$&lt;p&gt;And when $P_z$ is on the far plane:&lt;/p&gt;
$$
\begin{aligned}
\frac{A \cdot (P_z = -f) + B}{(-P_z = -(-f) = f)} = 1
\end{aligned}
$$$$
\begin{aligned}
\frac{A \cdot -f + B}{f} = 1
\end{aligned}
$$$$
\begin{aligned}
-fA + B = f
\end{aligned}
$$&lt;p&gt;These two equations form the following system of equations:&lt;/p&gt;
$$
\begin{aligned}
\begin{cases}
-nA + B = -n \\
-fA + B = f
\end{cases}
\end{aligned}
$$&lt;p&gt;We solve the first equation for $B$:&lt;/p&gt;
$$
\begin{aligned}
B = -n + An
\end{aligned}
$$&lt;p&gt;And we substitute on the second equation:&lt;/p&gt;
$$
\begin{aligned}
-fA + (-n + An) = f
\end{aligned}
$$$$
\begin{aligned}
A (n - f) = f + n
\end{aligned}
$$$$
\begin{aligned}
A= -\frac{f + n}{f - n}
\end{aligned}
$$&lt;p&gt;Finding $B$ is straightforward. We just replace $A$ in the first equation:&lt;/p&gt;
$$
\begin{aligned}
B = -n + (-\frac{f + n}{f - n})n
\end{aligned}
$$$$
\begin{aligned}
B = -n(1 + \frac{f + n}{f - n})
\end{aligned}
$$$$
\begin{aligned}
B = -n(\frac{f + n + f - n}{f - n})
\end{aligned}
$$$$
\begin{aligned}
B = -n(\frac{2f}{f - n})
\end{aligned}
$$$$
\begin{aligned}
B = -\frac{2fn}{f - n}
\end{aligned}
$$&lt;p&gt;We can replace the solutions we found for A and B in our matrix, and we finally get:&lt;/p&gt;
$$
\begin{aligned}
\begin{bmatrix}
\frac{2n}{r - l} &amp; 0 &amp; \frac{r + l}{r - l} &amp; 0 \\
0 &amp; \frac{2n}{t - b} &amp; \frac{t + b}{t - b} &amp; 0 \\
0 &amp; 0 &amp; -\frac{f + n}{f - n}&amp; -\frac{2fn}{f - n} \\
0 &amp; 0 &amp; -1 &amp; 0
\end{bmatrix}
\end{aligned}
$$&lt;h2&gt;The Field of View and Image Aspect Ratio&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;the-field-of-view-and-image-aspect-ratio&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#the-field-of-view-and-image-aspect-ratio&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The field of view and the image aspect ratio are somehow related to the projection process. The construction of the matrix relies on six parameters: the left, right, bottom, and top coordinates, as well as the near and far clipping planes. The user provides the values for the near and far clipping planes, but how about the left, right, bottom, and top coordinates? What are these, where do they come from, and how do we calculate them?&lt;/p&gt;
&lt;p&gt;Observing the following figure, you can see that these coordinates correspond to the lower-left and upper-right corners of the frustum front face, where the image of the 3D scene is projected:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;../../../assets/frustrum.png&#34; alt=&#34;Frustrum&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The angle of view can either be defined vertically or horizontally. OpenGL tends to define the field-of-view as vertical (hence the Y in FOVY).&lt;/p&gt;
&lt;h3&gt;Computing the Coordinates&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;computing-the-coordinates&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#computing-the-coordinates&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;To compute the top coordinate, we look at the right-angled triangle $ABC$ on the following image.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;../../../assets/camera_side_view.png&#34; alt=&#34;Camera Side View&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;The angle between by $AB$ and $AC$ is half the FOV. Also, the adjacent side of the triangle is the value for the near-clipping plane. Using &lt;a href=&#34;../../../../Math/Pre-Calculus/AGAA/08_03.md&#34; &gt;trigonometry&lt;/a&gt;, we can express this as:&lt;/p&gt;
$$
\begin{aligned}
\tan(\frac{FOVY}{2}) = \frac{opposite}{adyacent} = \frac{BC}{AB} = \frac{top}{near}
\end{aligned}
$$&lt;p&gt;Therefore:&lt;/p&gt;
$$
\begin{aligned}
top = \tan(\frac{FOVY}{2}) \cdot near
\end{aligned}
$$&lt;p&gt;And since the bottom half of the camera is symmetrical to the upper half, we can state that:&lt;/p&gt;
$$
\begin{aligned}
bottom = -top
\end{aligned}
$$&lt;p&gt;&lt;img src=&#34;../../../assets/aspect_ratio.png&#34; alt=&#34;Aspect Ratio&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;In Figure 5, two scenarios are considered: the image can either be square or rectangular. For a square camera, it&amp;rsquo;s straightforward: the left and bottom coordinates are the same, the right and top coordinates are also the same. Therefore:&lt;/p&gt;
$$
\begin{aligned}
top = \tan(\frac{FOVY}{2}) \cdot near
\end{aligned}
$$$$
\begin{aligned}
left = bottom = -top
\end{aligned}
$$$$
\begin{aligned}
right = top
\end{aligned}
$$&lt;p&gt;For a non-square camera, as shown in the right inside of figure 5, the bottom and top coordinates remain the same, but the left and right coordinates are scaled by the aspect ratio, defined as the image width over the image height. The general formulas for computing the left, right, and bottom coordinates are:&lt;/p&gt;
$$
\begin{aligned}
aspect ratio = \frac{width}{heigth}
\end{aligned}
$$$$
\begin{aligned}
top = \tan(\frac{FOVY}{2}) \cdot near
\end{aligned}
$$$$
\begin{aligned}
bottom = -top
\end{aligned}
$$$$
\begin{aligned}
right = top \cdot aspect ratio
\end{aligned}
$$$$
\begin{aligned}
left = bottom \cdot aspect ratio
\end{aligned}
$$&lt;h2&gt;Note&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;note&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#note&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;This section is kinda important, up until now we have define this projection matrix on what we call &lt;a href=&#34;https://en.mdpedia.org/wiki/Row-_and_column-major_order&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;row-major order&lt;/a&gt;. However, WebGL expects us to use matrices defined on &lt;a href=&#34;https://en.mdpedia.org/wiki/Row-_and_column-major_order&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;column-major order&lt;/a&gt;. See &lt;a href=&#34;./01_transformations.md#Transposing%20Transformation%20or%20Projection%20Matrices&#34; &gt;Transposing Transformation or Projection Matrices&lt;/a&gt; on how to correctly defined these matrices.&lt;/p&gt;
&lt;h2&gt;References&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;references&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#references&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://www.scratchapixel.com/lessons/3d-basic-rendering/perspective-and-orthographic-projection-matrix/opengl-perspective-projection-matrix.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Perspective Projection Matrix&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

      </description>
    </item>
    
    <item>
      <title>Orthografic Matrix</title>
      <link>//localhost:1313/notes/cs/rtgw/04/02_model_view/02_02_orthographic/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>//localhost:1313/notes/cs/rtgw/04/02_model_view/02_02_orthographic/</guid>
      <description>
        
        
        &lt;h2&gt;Intro&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;intro&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#intro&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;In this chapter, we will explore how to construct a matrix that projects a point from camera space onto the image plane of an orthographic camera.&lt;/p&gt;
&lt;p&gt;The aim of the orthographic projection matrix is to remap all coordinates within a specific 3D space bounding box to the &lt;strong&gt;canonical viewing volume&lt;/strong&gt;. For that we need to know the scene&amp;rsquo;s bounding box, that is the bounding box that encompasses all the objects on the scene. The orthographic matrix then aims to remap this box to a canonical view volume, defined by minimum and maximum extents of $(-1, -1, -1)$ and $(1, 1, 1)$.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;../../../assets/orthographic_perspective_bounding_box.png&#34; alt=&#34;Bounding Boxes&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Once we have computed the scene bounding box, we need to project the minimum and maximum extents of this bounding box onto the image plane of the camera. The $x$- and $y$-coordinates of any point expressed in camera space and the $x$- and $y$-coordinates of the same points projected onto the image plane remain identical. It may be necessary to adjust the projection of the bounding box&amp;rsquo;s minimum and maximum extents onto the screen to ensure the screen window is either square or maintains the same aspect ratio as the image.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;../../../assets/camera_to_image_mapping.png&#34; alt=&#34;Camera Coordinates Mapping to Image Coordinates&#34; loading=&#34;lazy&#34; /&gt;&lt;/p&gt;
&lt;h2&gt;Derivation&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;derivation&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#derivation&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;We will refer to these screen coordinates as $l$, $r$, $t$, and $b$, which stand for left, right, top, and bottom, respectively.&lt;/p&gt;
&lt;h3&gt;Projection of $x$&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;projection-of-x&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#projection-of-x&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Now, we need to remap the left and right screen coordinates $(l, r)$ to $-1$ and $1$, and apply the same remapping to the top and bottom coordinates $(t, b)$. Assuming $x$ is any point within the range $[l ,r]$, we can state:&lt;/p&gt;
$$
\begin{aligned}
l \leq x \leq r
\end{aligned}
$$$$
\begin{aligned}
0 \leq x - l \leq r - l
\end{aligned}
$$$$
\begin{aligned}
0 \leq \frac{x - l}{r - l} \leq 1
\end{aligned}
$$$$
\begin{aligned}
0 \leq 2\frac{x - l}{r - l} \leq 2
\end{aligned}
$$$$
\begin{aligned}
-1 \leq 2\frac{x - l}{r - l} -1 \leq 1
\end{aligned}
$$&lt;p&gt;Now, the middle term falls within the range $[-1, 1]$, successfully remapping it. To further develop this formula:&lt;/p&gt;
$$
\begin{aligned}
-1 \leq \frac{2x - 2l - r + l}{r - l} \leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{2x - l - r}{r - l} \leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{2x}{r - l} - \frac{r + l}{r - l} \leq 1
\end{aligned}
$$&lt;p&gt;This yields the transformation formula for $x$:&lt;/p&gt;
$$
\begin{aligned}
x&#39; = \frac{2x}{r - l} - \frac{r + l}{r - l}
\end{aligned}
$$&lt;p&gt;To represent this transformation in matrix form:&lt;/p&gt;
$$
\begin{aligned}
\begin{bmatrix}
\frac{2}{r - l} &amp; 0 &amp; 0 &amp; -\frac{r + l}{r - l} \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 \\
\end{bmatrix}
\end{aligned}
$$&lt;p&gt;So:&lt;/p&gt;
$$
\begin{aligned}
\begin{bmatrix}
\frac{2}{r - l} &amp; 0 &amp; 0 &amp; -\frac{r + l}{r - l} \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 \\
\end{bmatrix} \cdot
\begin{bmatrix}
x \\
y \\
z \\
1 \\
\end{bmatrix} =
\begin{bmatrix}
\frac{2x}{r - l} - \frac{r + l}{r - l} \\
y \\
z \\
1 \\
\end{bmatrix}
\end{aligned}
$$&lt;h3&gt;Projection of $y$&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;projection-of-y&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#projection-of-y&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The process for the y-coordinate is the same. You just need to replace $r$ and $l$ with $t$ and $b$ (top and bottom).&lt;/p&gt;
$$
\begin{aligned}
b \leq y \leq t
\end{aligned}
$$$$
\begin{aligned}
0 \leq y - b \leq t - b
\end{aligned}
$$$$
\begin{aligned}
0 \leq \frac{y - b}{t - b} \leq 1
\end{aligned}
$$$$
\begin{aligned}
0 \leq 2\frac{y - b}{t - b} \leq 2
\end{aligned}
$$$$
\begin{aligned}
-1 \leq 2\frac{y - b}{t - b} - 1 \leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{2y - 2b - t + b}{t - b} \leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{2y - b - t}{t - b} \leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{2y}{t - b} - \frac{t + b}{t - b} \leq 1
\end{aligned}
$$&lt;p&gt;So the transformation formula for $y$ is as follows:&lt;/p&gt;
$$
\begin{aligned}
y&#39; = \frac{2y}{t - b} - \frac{t + b}{t - b}
\end{aligned}
$$&lt;p&gt;Which yields the following transformation matrix:&lt;/p&gt;
$$
\begin{aligned}
\begin{bmatrix}
\frac{2}{r - l} &amp; 0 &amp; 0 &amp; -\frac{r + l}{r - l} \\
0 &amp; \frac{2}{t - b} &amp; 0 &amp; -\frac{t + b}{t - b} \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 \\
\end{bmatrix}
\end{aligned}
$$&lt;p&gt;So:&lt;/p&gt;
$$
\begin{aligned}
\begin{bmatrix}
\frac{2}{r - l} &amp; 0 &amp; 0 &amp; -\frac{r + l}{r - l} \\
0 &amp; \frac{2}{t - b} &amp; 0 &amp; -\frac{t + b}{t - b} \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 \\
\end{bmatrix} \cdot
\begin{bmatrix}
x \\
y \\
z \\
1 \\
\end{bmatrix} =
\begin{bmatrix}
\frac{2x}{r - l} - \frac{r + l}{r - l} \\
\frac{2y}{t - b} - \frac{t + b}{t - b} \\
z \\
1 \\
\end{bmatrix}
\end{aligned}
$$&lt;h3&gt;Projection of $z$&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;projection-of-z&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#projection-of-z&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;And finally, to complete our orthographic projection matrix, we need to remap the z-coordinates from $-1$ to $1$. We start with the following condition:&lt;/p&gt;
$$
\begin{aligned}
n \leq -z \leq f
\end{aligned}
$$&lt;p&gt;Don&amp;rsquo;t forget that the $z$-coordinates of all points visible to the camera are negative, which is why we use $-z$ instead of $z$.&lt;/p&gt;
$$
\begin{aligned}
0 \leq -z - n\leq f - n
\end{aligned}
$$$$
\begin{aligned}
0 \leq \frac{-z - n}{f - n} \leq 1
\end{aligned}
$$$$
\begin{aligned}
0 \leq 2\frac{-z - n}{f - n} \leq 2
\end{aligned}
$$$$
\begin{aligned}
-1 \leq 2\frac{-z - n}{f - n} - 1 \leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{-2z - 2n -f + n}{f - n} \leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{-2z - n - f}{f - n} \leq 1
\end{aligned}
$$$$
\begin{aligned}
-1 \leq \frac{-2z}{f - n} - \frac{n + f}{n - f}{f - n} \leq 1
\end{aligned}
$$&lt;p&gt;Now we add this to the matrix:&lt;/p&gt;
$$
\begin{aligned}
\begin{bmatrix}
\frac{2}{r - l} &amp; 0 &amp; 0 &amp; -\frac{r + l}{r - l} \\
0 &amp; \frac{2}{t - b} &amp; 0 &amp; -\frac{t + b}{t - b} \\
0 &amp; 0 &amp; -\frac{2}{f - n} &amp; -\frac{n + f}{n - f} \\
0 &amp; 0 &amp; 0 &amp; 1 \\
\end{bmatrix}
\end{aligned}
$$&lt;p&gt;So:&lt;/p&gt;
$$
\begin{aligned}
\begin{bmatrix}
\frac{2}{r - l} &amp; 0 &amp; 0 &amp; -\frac{r + l}{r - l} \\
0 &amp; \frac{2}{t - b} &amp; 0 &amp; -\frac{t + b}{t - b} \\
0 &amp; 0 &amp; -\frac{2}{f - n} &amp; -\frac{n + f}{n - f} \\
0 &amp; 0 &amp; 0 &amp; 1 \\
\end{bmatrix} \cdot
\begin{bmatrix}
x \\
y \\
z \\
1 \\
\end{bmatrix} =
\begin{bmatrix}
\frac{2x}{r - l} - \frac{r + l}{r - l} \\
\frac{2y}{t - b} - \frac{t + b}{t - b} \\
\frac{-2z}{f - n} - \frac{f + n}{f - n} \\
1 \\
\end{bmatrix}
\end{aligned}
$$&lt;h2&gt;Note&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;note&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#note&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;This section is kinda important, up until now we have define this projection matrix on what we call &lt;a href=&#34;https://en.mdpedia.org/wiki/Row-_and_column-major_order&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;row-major order&lt;/a&gt;. However, WebGL expects us to use matrices defined on &lt;a href=&#34;https://en.mdpedia.org/wiki/Row-_and_column-major_order&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;column-major order&lt;/a&gt;. See &lt;a href=&#34;../../01_transformations#transposing-transformation-or-projection-matrices&#34; &gt;Transposing Transformation or Projection Matrices&lt;/a&gt; on how to correctly defined these matrices.&lt;/p&gt;
&lt;h2&gt;References&lt;span class=&#34;hx-absolute -hx-mt-20&#34; id=&#34;references&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#references&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://www.scratchapixel.com/lessons/3d-basic-rendering/perspective-and-orthographic-projection-matrix/orthographic-projection-matrix.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Orthographic Matrix&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

      </description>
    </item>
    
  </channel>
</rss>
